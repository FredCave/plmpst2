THREE.TrackballControls=function(a,b){function c(a){m.enabled!==!1&&(window.removeEventListener("keydown",c),r=q,q===n.NONE&&(a.keyCode!==m.keys[n.ROTATE]||m.noRotate?a.keyCode!==m.keys[n.ZOOM]||m.noZoom?a.keyCode!==m.keys[n.PAN]||m.noPan||(q=n.PAN):q=n.ZOOM:q=n.ROTATE))}function d(a){m.enabled!==!1&&(q=r,window.addEventListener("keydown",c,!1))}function e(a){m.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),q===n.NONE&&(q=a.button),q!==n.ROTATE||m.noRotate?q!==n.ZOOM||m.noZoom?q!==n.PAN||m.noPan||(B.copy(G(a.pageX,a.pageY)),C.copy(B)):(x.copy(G(a.pageX,a.pageY)),y.copy(x)):(u.copy(H(a.pageX,a.pageY)),t.copy(u)),document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",g,!1),m.dispatchEvent(E))}function f(a){m.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),q!==n.ROTATE||m.noRotate?q!==n.ZOOM||m.noZoom?q!==n.PAN||m.noPan||C.copy(G(a.pageX,a.pageY)):y.copy(G(a.pageX,a.pageY)):(t.copy(u),u.copy(H(a.pageX,a.pageY))))}function g(a){m.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),q=n.NONE,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),m.dispatchEvent(F))}function h(a){}function i(a){if(m.enabled!==!1){switch(a.touches.length){case 1:q=n.TOUCH_ROTATE,u.copy(H(a.touches[0].pageX,a.touches[0].pageY)),t.copy(u);break;default:q=n.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;A=z=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;B.copy(G(d,e)),C.copy(B)}m.dispatchEvent(E)}}function j(a){if(m.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:t.copy(u),u.copy(H(a.touches[0].pageX,a.touches[0].pageY));break;default:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;A=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;C.copy(G(d,e))}}function k(a){if(m.enabled!==!1){switch(a.touches.length){case 0:q=n.NONE;break;case 1:q=n.TOUCH_ROTATE,u.copy(H(a.touches[0].pageX,a.touches[0].pageY)),t.copy(u)}m.dispatchEvent(F)}}function l(a){m.enabled!==!1&&a.preventDefault()}var m=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var o=1e-6,p=new THREE.Vector3,q=n.NONE,r=n.NONE,s=new THREE.Vector3,t=new THREE.Vector2,u=new THREE.Vector2,v=new THREE.Vector3,w=0,x=new THREE.Vector2,y=new THREE.Vector2,z=0,A=0,B=new THREE.Vector2,C=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var D={type:"change"},E={type:"start"},F={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft,this.screen.top=a.top+window.pageYOffset-b.clientTop,this.screen.width=a.width,this.screen.height=a.height}},this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)};var G=function(){var a=new THREE.Vector2;return function(b,c){return a.set((b-m.screen.left)/m.screen.width,(c-m.screen.top)/m.screen.height),a}}(),H=function(){var a=new THREE.Vector2;return function(b,c){return a.set((b-.5*m.screen.width-m.screen.left)/(.5*m.screen.width),(m.screen.height+2*(m.screen.top-c))/m.screen.width),a}}();this.rotateCamera=function(){var a,b=new THREE.Vector3,c=new THREE.Quaternion,d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3;return function(){g.set(u.x-t.x,u.y-t.y,0),a=g.length(),a?(s.copy(m.object.position).sub(m.target),d.copy(s).normalize(),e.copy(m.object.up).normalize(),f.crossVectors(e,d).normalize(),e.setLength(u.y-t.y),f.setLength(u.x-t.x),g.copy(e.add(f)),b.crossVectors(g,s).normalize(),a*=m.rotateSpeed,c.setFromAxisAngle(b,a),s.applyQuaternion(c),m.object.up.applyQuaternion(c),v.copy(b),w=a):!m.staticMoving&&w&&(w*=Math.sqrt(1-m.dynamicDampingFactor),s.copy(m.object.position).sub(m.target),c.setFromAxisAngle(v,w),s.applyQuaternion(c),m.object.up.applyQuaternion(c)),t.copy(u)}}(),this.zoomCamera=function(){var a;q===n.TOUCH_ZOOM_PAN?(a=z/A,z=A,s.multiplyScalar(a)):(a=1+(y.y-x.y)*m.zoomSpeed,1!==a&&a>0&&s.multiplyScalar(a),m.staticMoving?x.copy(y):x.y+=(y.y-x.y)*this.dynamicDampingFactor)},this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(C).sub(B),a.lengthSq()&&(a.multiplyScalar(s.length()*m.panSpeed),c.copy(s).cross(m.object.up).setLength(a.x),c.add(b.copy(m.object.up).setLength(a.y)),m.object.position.add(c),m.target.add(c),m.staticMoving?B.copy(C):B.add(a.subVectors(C,B).multiplyScalar(m.dynamicDampingFactor)))}}(),this.checkDistances=function(){m.noZoom&&m.noPan||(s.lengthSq()>m.maxDistance*m.maxDistance&&(m.object.position.addVectors(m.target,s.setLength(m.maxDistance)),x.copy(y)),s.lengthSq()<m.minDistance*m.minDistance&&(m.object.position.addVectors(m.target,s.setLength(m.minDistance)),x.copy(y)))},this.update=function(){s.subVectors(m.object.position,m.target),m.noRotate||m.rotateCamera(),m.noZoom||m.zoomCamera(),m.noPan||m.panCamera(),m.object.position.addVectors(m.target,s),m.checkDistances(),m.object.lookAt(m.target),p.distanceToSquared(m.object.position)>o&&(m.dispatchEvent(D),p.copy(m.object.position))},this.reset=function(){q=n.NONE,r=n.NONE,m.target.copy(m.target0),m.object.position.copy(m.position0),m.object.up.copy(m.up0),s.subVectors(m.object.position,m.target),m.object.lookAt(m.target),m.dispatchEvent(D),p.copy(m.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",l,!1),this.domElement.removeEventListener("mousedown",e,!1),this.domElement.removeEventListener("wheel",h,!1),this.domElement.removeEventListener("touchstart",i,!1),this.domElement.removeEventListener("touchend",k,!1),this.domElement.removeEventListener("touchmove",j,!1),document.removeEventListener("mousemove",f,!1),document.removeEventListener("mouseup",g,!1),window.removeEventListener("keydown",c,!1),window.removeEventListener("keyup",d,!1)},this.domElement.addEventListener("contextmenu",l,!1),this.domElement.addEventListener("mousedown",e,!1),this.domElement.addEventListener("wheel",h,!1),this.domElement.addEventListener("touchstart",i,!1),this.domElement.addEventListener("touchend",k,!1),this.domElement.addEventListener("touchmove",j,!1),window.addEventListener("keydown",c,!1),window.addEventListener("keyup",d,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;var Page={currentRandomLayers:[],phasedLayer:"",temples:["A2","B2","C2","D1","E2"],init:function(){console.log("Page.init"),Info.detectMobile()?(console.log(15,"Mobile"),$("#mobile_wrapper").fadeIn(1e3)):this.loadCubeData(),Info.init(),this.bindEvents()},bindEvents:function(){console.log("Page.bindEvents");var a=this;$("#button_wrapper a").on("click",function(b){b.preventDefault(),$("#main_audio")[0].play(),$("#main_audio")[0].pause(),$("#loop_audio_1")[0].play(),$("#loop_audio_1")[0].pause(),$("#loop_audio_2")[0].play(),$("#loop_audio_2")[0].pause(),a.startAudio(),$("#mobile_wrapper").fadeOut(1e3),_.delay(function(){a.loadCubeData()},1e3)})},loadCubeData:function(){console.log("Page.loadCubeData");var a=this;$.get(ROOT+"/wp-json/custom/v1/cubes",function(b){a.cubeData=b,a.cubeDataLoaded()}).fail(function(){console.log("Ajax error. Cube not loaded.")})},cubeDataLoaded:function(){console.log("Page.cubeDataLoaded"),Space.init(),Space.animate(),this.startAudio(),this.startAnimation()},startAudio:function(){console.log("Page.startAudio");var a=this;$("#main_audio").prop("volume",.1),$("#main_audio")[0].play(),$("#main_audio").animate({volume:1},1e3),setTimeout(function(){a.startAudioLoop()},235e3)},startAudioLoop:function(){console.log("Page.startAudioLoop"),$("#loop_audio_1").prop("volume",.1),$("#loop_audio_1")[0].play(),$("#loop_audio_1").animate({volume:1},1e4,function(){var a=2;$("#loop_audio_"+a)[0].play(),setInterval(function(){a=1===a?2:1,$("#loop_audio_"+a)[0].play()},1e4)})},startAnimation:function(){console.log("Page.startAnimation"),this.sceneOne(),_.delay(this.sceneTwo,3e4),_.delay(this.sceneThree,7e4),_.delay(this.sceneFour,105e3),_.delay(this.sceneFive,135e3),_.delay(this.sceneSix,17e4),_.delay(this.sceneSeven,21e4),_.delay(this.sceneEight,225e3)},sceneOne:function(){console.log("Page.sceneOne"),Space.fadeInLayer("A2",1e3),Page.randomFade("A,B,C")},sceneTwo:function(){console.log("Page.sceneTwo"),Space.fadeInLayer("B2",4e3),Space.fadeOutLayer("A2",8e3)},sceneThree:function(){console.log("Page.sceneThree"),Space.fadeInLayer("C2",8e3),Space.fadeOutLayer("B2",8e3)},sceneFour:function(){console.log("Page.sceneFour"),Space.fadeInLayer("D1",8e3),Space.fadeOutLayer("C2",8e3),Page.stopRandomFade(),Page.randomFade("D,E")},sceneFive:function(){console.log("Page.sceneFive"),Space.fadeInLayer("E2",1e4),Space.fadeOutLayer("D1",1e4)},sceneSix:function(){console.log("Page.sceneSix"),Page.stopRandomFade(),Space.fadeOutLayer("E2",5e3);for(var a=1;a<10;a++)Space.fadeInLayer("F"+a,5e3*Math.random()+3e3)},sceneSeven:function(){console.log("Page.sceneSeven"),Space.fadeOutLayer("F8",5e3),_.delay(Space.fadeOutLayer("F1",5e3*Math.random()+8e3),2e3),_.delay(Space.fadeOutLayer("F2",5e3*Math.random()+7e3),3e3),_.delay(Space.fadeOutLayer("F3",5e3*Math.random()+6e3),4e3),_.delay(Space.fadeOutLayer("F5",5e3*Math.random()+5e3),5e3),_.delay(Space.fadeOutLayer("F6",5e3*Math.random()+5e3),5e3),_.delay(Space.fadeOutLayer("F7",5e3*Math.random()+4e3),6e3),_.delay(Space.fadeOutLayer("F9",5e3*Math.random()+3e3),7e3)},sceneEight:function(){console.log("Page.sceneEight"),Space.fadeOutLayer("F4",15e3),Space.fadeInLayer("G1",15e3)},randomFade:function(a){function b(){console.log("Page.randomFade.randomIteration");for(var a=0;a<4;a++){var b=Math.floor(Math.random()*d.length),c=d[b].ID;if(Page.currentRandomLayers.indexOf(c)===-1){var e=1e4*Math.random()+5e3;Space.fadeInLayer(c,e),Page.currentRandomLayers.push(c)}}_.delay(function(){for(var a=0;a<Page.currentRandomLayers.length;a++){var b=Page.currentRandomLayers[a];Space.fadeOutLayer(b,5e3*Math.random()+5e3),Page.currentRandomLayers.splice(a,1)}},1e4)}console.log("Page.randomFade");for(var c=a.split(","),d=[],e=this,f=0;f<c.length;f++){var g=c[f].charCodeAt(0)-65;_.each(Page.cubeData[g],function(a){e.temples.indexOf(a.ID)===-1&&d.push(a)})}b(),this.interval=setInterval(function(){b()},2e4)},stopRandomFade:function(){console.log("Page.stopRandomFade"),clearInterval(this.interval);for(var a=0;a<Page.currentRandomLayers.length;a++){var b=Page.currentRandomLayers[a];Space.fadeOutLayer(b,5e3*Math.random()+5e3),Page.currentRandomLayers.splice(a,1)}}};$(document).on("ready",function(){Page.init()});var Space={container:"",scene:"",camera:"",renderer:"",controls:"",cube:"",clock:new THREE.Clock,cubeIndex:0,axesVisible:!1,init:function(){console.log("Space.init");this.scene=new THREE.Scene;var a=window.innerWidth,b=window.innerHeight,c=45,d=a/b,e=.1,f=2e4;this.camera=new THREE.PerspectiveCamera(c,d,e,f),this.scene.add(this.camera),this.camera.position.set(0,-100,400),this.camera.lookAt(this.scene.position),Detector.webgl?this.renderer=new THREE.WebGLRenderer({antialias:!0}):this.renderer=new THREE.CanvasRenderer,this.renderer.setSize(a,b),this.renderer.autoClear=!1,this.container=document.getElementById("space"),this.container.appendChild(this.renderer.domElement),THREEx.WindowResize(this.renderer,this.camera),this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.createSceneTwo()},createSceneTwo:function(){console.log("Space.createSceneTwo"),this.renderer.autoClear=!1,this.sceneTwo=new THREE.Scene},animate:function(){var a=this;setTimeout(function(){requestAnimationFrame(function(){a.animate()})},1e3/24),this.render();var b=(new Date).getTime()/1e3,c=b-(a.lastFrameTime||b);a.totalGameTime+=c,this.update(c,a.totalGameTime),TWEEN.update(),a.lastFrameTime=b},lastFrameTime:(new Date).getTime()/1e3,totalGameTime:0,update:function(a,b){var c=this;this.controls.update(),this.isDragging&&""!==Page.phasedLayer&&(Page.phasedLayer.rotation.y+=.1*a),setTimeout(function(){var a=(new Date).getTime()/1e3,b=a-(c.lastFrameTime||a);c.totalGameTime+=b,c.update(b,c.totalGameTime)},0)},render:function(){this.renderer.clear(),this.renderer.render(this.sceneTwo,this.camera),this.renderer.clearDepth(),this.renderer.render(this.scene,this.camera),this.renderer.clearDepth()},generateCube:function(){console.log("Space.generateCube")},prepareLayer:function(a,b){function c(){if(console.log("imagePreloader",j),!(j<h.length-1))return console.log("All images preloaded."),void g.generateLayer(h,e,b);var a=new Image;$(a).attr("src",h[j]).on("load",function(){console.log(234,j,"Image loaded."),j++,c()})}console.log("Space.prepareLayer");var d,e,f=!0,g=this,h=[];for(var i in a)a.hasOwnProperty(i)&&(a[i]===!1?f=!1:"name"===i?d=a[i]:"ID"===i?e=a[i]:h.push(a[i].url));if(f){var j=0;c()}},generateLayer:function(a,b,c){console.log("Space.generateLayer",b,c);for(var d=6e3,e=new THREE.CubeGeometry(d,d,d),f=[],g=0;g<6;g++)f.push(new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(a[g]),side:THREE.BackSide,transparent:!0,opacity:0}));var h=new THREE.MeshFaceMaterial(f),i=new THREE.Mesh(e,h);i.frustumCulled=!1,i.name=b,"E4"===b||"C4"===b||"B3"===b||"A4"===b?this.sceneTwo.add(i):this.scene.add(i),i.rotateY(180),setTimeout(function(){for(var a=0;a<i.material.length;a++)new TWEEN.Tween(i.material[a]).to({opacity:1},c).start()},500)},hideLayer:function(a){console.log("Space.hideLayer",a);var b=this.scene.getObjectByName(a)||this.camera.getObjectByName(a);_.each(b.material.materials,function(a){a.opacity=0})},showLayer:function(a){console.log("Space.showLayer",a);var b=this.scene.getObjectByName(a)||this.camera.getObjectByName(a);_.each(b.material.materials,function(a){a.opacity=1})},fadeInLayer:function(a,b){console.log("Space.fadeInLayer",a,b);var c=a[0].charCodeAt(0)-65,d=_.findWhere(Page.cubeData[c],{ID:a});this.prepareLayer(d,b)},fadeOutLayer:function(a,b){console.log("Space.fadeOutLayer",a,b);var c=this.scene.getObjectByName(a)||this.sceneTwo.getObjectByName(a),d=this;if(void 0!==c){for(var e=0;e<c.material.length;e++)new TWEEN.Tween(c.material[e]).to({opacity:0},b).start();_.delay(function(){console.log(346),d.scene.remove(d.scene.getObjectByName(a))},b+1e3)}},hideCube:function(a){console.log("Space.hideCube",a);var b=this.scene.children;_.each(b,function(b){b.name.indexOf(a)>-1&&_.each(b.material.materials,function(a){a.opacity=0})})},showCube:function(a){console.log("Space.showCube",a);var b=this.scene.children;_.each(b,function(b){b.name.indexOf(a)>-1&&_.each(b.material.materials,function(a){a.opacity=1})})},toggleAxes:function(){console.log("Space.toggleAxes");var a=this.scene.getObjectByName("axes");this.axesVisible?(a.visible=!1,this.axesVisible=!1):(a.visible=!0,this.axesVisible=!0)},changeOpacity:function(a,b){console.log("Space.changeOpacity",a,b);var c=this.scene.children;_.each(c,function(c){c.name.indexOf(a)>-1&&_.each(c.material.materials,function(a){b>0&&a.opacity>0&&(a.opacity=b)})})},changeSize:function(a,b){console.log("Space.changeSize",a,b);var c=this.scene.children;b=5e3*(b+1),_.each(c,function(c){c.name.indexOf(a)>-1&&(c.geometry.depth=b,c.geometry.height=b,c.geometry.width=b)})},isDragging:!1,rotateLayer:function(a){function b(a){return a*(Math.PI/180)}console.log("Space.rotateLayer",a);var c=this;if(""!==this.phasedLayer){var d={x:0,y:0};$("#space").on("mousedown",function(a){c.isDragging=!0}).on("mousemove",function(a){var e={x:a.offsetX-d.x,y:a.offsetY-d.y};if(c.isDragging){var f=(new THREE.Quaternion).setFromEuler(new THREE.Euler(b(1*e.y),b(1*e.x),0,"XYZ"));c.phasedLayer.quaternion.multiplyQuaternions(f,cube.quaternion)}d={x:a.offsetX,y:a.offsetY}}),$(document).on("mouseup",function(a){c.isDragging=!1})}}},Spin={};